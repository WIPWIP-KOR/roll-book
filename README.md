# ⚽ 풋살 동호회 출석부

QR코드와 GPS 위치 기반 출석 체크 시스템

## 📋 주요 기능

### 기본 출석 기능
- **QR 코드 기반 출석**: QR 코드 스캔으로 간편한 웹 접속
- **GPS 위치 인증**: 지정된 위치에서 50m 이내일 때만 출석 인정
- **자동 회원 관리**: 첫 방문 시 이름/팀 입력 → 이후 선택만으로 출석
- **중복 방지**: 기기 ID 기반으로 당일 중복 출석 차단
- **지각 체크**: 설정된 출석 시간 이후 도착 시 지각 표시

### 출석 요청 시스템 🆕
- **사진 인증**: 출석 실패 시 현장 사진 촬영하여 관리자에게 승인 요청
- **Google Drive 연동**: 촬영한 사진 자동 업로드 및 날짜별 폴더 정리
- **동료 선택**: 현장에 있는 랜덤 동료 5명 중 1명 선택하여 진위 확인
- **승인/거절 시스템**: 관리자가 사진 확인 후 출석 승인/거절

### 시즌 관리 🆕
- **상반기/하반기 자동 구분**: 1~6월 상반기, 7~12월 하반기
- **시즌별 팀 관리**: 시즌마다 다른 팀 소속 가능
- **시즌별 통계**: 시즌 단위로 출석률 조회

### 관리 기능
- **구글 시트 연동**: 모든 출석 데이터 자동 저장 (연도별 분리)
- **통계 대시보드**: 개인별/팀별 출석률 실시간 확인 (시즌 필터링 가능)
- **수동 출석 처리**: 관리자가 직접 출석 기록 추가
- **출석 승인 관리**: 대기 중인 출석 요청 목록 확인 및 처리

## 🛠 기술 스택

- **프론트엔드**: HTML, CSS, JavaScript (순수)
- **백엔드**: Google Apps Script
- **데이터베이스**: Google Sheets
- **호스팅**: GitHub Pages / Netlify (무료)
- **서버**: 없음 (완전 서버리스)

## 📁 프로젝트 구조

```
roll-book/
├── index.html              # 출석 페이지
├── admin.html              # 관리자 페이지
├── stats.html              # 통계 페이지
├── css/
│   └── style.css          # 스타일시트 (모바일 최적화)
├── js/
│   ├── attendance.js      # 출석 로직
│   ├── admin.js           # 관리자 기능
│   └── stats.js           # 통계 계산
└── google-apps-script/
    └── Code.gs            # 백엔드 로직
```

## 🚀 배포 가이드

### 1단계: Google Sheets 설정

1. [Google Sheets](https://sheets.google.com) 접속
2. 새 스프레드시트 생성 (예: "풋살 출석부")
3. **확장 프로그램** > **Apps Script** 클릭
4. `google-apps-script/Code.gs` 파일의 내용 전체 복사 & 붙여넣기
5. **좌측 메뉴에서 `appsscript.json` 파일 복사** (Google Drive API 권한 필요)
6. **저장** (Ctrl+S)
7. **배포** > **새 배포** 클릭
8. **설정**:
   - **유형 선택**: 웹 앱
   - **다음 계정으로 실행**: **나** (중요!)
   - **액세스 권한**: **모든 사용자**
9. **배포** 클릭
10. **권한 승인**:
    - Google 계정으로 로그인
    - "고급" → "안전하지 않은 페이지로 이동" 클릭
    - Google Drive 접근 권한 승인
11. **웹 앱 URL 복사** (예: `https://script.google.com/macros/s/...`)

### 2단계: 프론트엔드 설정

1. `js/attendance.js` 파일 열기
2. 1번 줄의 `GAS_URL` 값을 복사한 웹 앱 URL로 변경:
   ```javascript
   GAS_URL: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'
   ```

3. `js/admin.js` 파일 열기
4. 동일하게 `GAS_URL` 변경

5. `js/stats.js` 파일 열기
6. 동일하게 `GAS_URL` 변경

### 3단계: GitHub Pages 배포

#### 방법 1: GitHub 웹 인터페이스

1. GitHub 저장소 생성
2. 모든 파일 업로드
3. **Settings** > **Pages**
4. **Source**: `main` 브랜치 선택
5. **Save** 클릭
6. 배포 URL 확인 (예: `https://username.github.io/roll-book/`)

#### 방법 2: Git 명령어

```bash
git add .
git commit -m "Initial commit"
git push -u origin claude/futsal-attendance-system-01HzuAjoKF2wp9MhHCT3BeFG
```

그 후 GitHub Settings에서 Pages 설정

### 4단계: QR 코드 생성

1. 배포된 URL 접속 (예: `https://username.github.io/roll-book/admin.html`)
2. 관리자 페이지에서:
   - 출석 장소 위치 설정 (위도/경도)
   - QR 코드 생성 버튼 클릭
   - QR 코드 다운로드
3. QR 코드를 인쇄하거나 디지털로 공유

## 📖 사용 방법

### 관리자

1. **admin.html** 접속

2. **위치설정 탭**:
   - 현재 위치 가져오기 버튼 클릭
   - 또는 직접 위도/경도 입력
   - 장소 이름 입력 후 저장

3. **QR코드 탭**:
   - QR 코드 생성 버튼 클릭
   - 다운로드하여 출석 장소에 비치

4. **회원목록 탭**:
   - 전체 회원 조회
   - 시즌별 팀 정보 확인
   - 출석 통계 확인

5. **출석승인 탭** 🆕:
   - 대기 중인 출석 요청 목록 확인
   - 각 요청별 정보 확인:
     - 요청자 이름, 팀, 시즌
     - 출석 실패 사유
     - 선택한 동료 (또는 빈 풋살장)
     - 요청 일시
   - **사진 보기**: 촬영한 현장 사진 확인
   - **승인**: 출석 인정 처리
   - **거부**: 요청 삭제

6. **수동출석 탭**:
   - 특정 날짜의 미출석자 조회
   - 관리자가 직접 출석 기록 추가

7. **설정 탭**:
   - 관리자 비밀번호 설정
   - 출석 시간, 요일, 거리 설정

### 회원 (출석)

#### 정상 출석
1. QR 코드 스캔 → 출석 페이지 접속
2. **첫 출석**:
   - 이름 입력
   - 팀 선택 (A/B/C)
   - 위치 정보 권한 허용
   - 출석하기 버튼 클릭
3. **재출석**:
   - 저장된 이름 목록에서 선택
   - 위치 정보 자동 확인
   - 출석하기 버튼 클릭

#### 출석 요청 (GPS 실패 시) 🆕
1. **출석 실패 메시지 확인**:
   - 위치가 50m 밖이거나 GPS 오류 시
   - "출석 요청하기" 버튼 표시
2. **요청서 작성**:
   - 사진 촬영 (현장 인증)
   - 현장에 있는 동료 5명 중 1명 선택
   - 또는 "빈 풋살장" 선택 (아무도 없을 경우)
   - 출석 실패 사유 입력
3. **요청 제출**:
   - 관리자 승인 대기
   - 승인 시 출석 인정, 거절 시 미출석 처리

### 통계 확인

1. **stats.html** 접속
2. 확인 가능한 정보:
   - 팀별 평균 출석률
   - 개인별 출석률 (필터링/정렬 가능)
   - 주차별 출석 현황

## 📊 구글 시트 구조

배포 후 자동으로 다음 시트들이 생성됩니다:

### 출석기록 (연도별 자동 생성)
시트명 예시: `출석기록_2026`

| 날짜 | 요일 | 이름 | 팀 | 시즌 | 출석시간 | 지각여부 | 위도 | 경도 | 기기ID | 거리(m) |
|------|------|------|-----|------|----------|----------|------|------|--------|---------|
| 2026-01-15 | 수 | 홍길동 | A | 상반기 | 19:30 | N | 37.xxx | 126.xxx | hash... | 15 |

### 회원목록
시즌별 팀 정보 별도 관리

| 이름 | 상반기팀 | 하반기팀 | 최초등록일 | 총출석수 |
|------|----------|----------|-----------|----------|
| 홍길동 | A | B | 2026-01-15 | 5 |

### 출석요청 🆕
대기 중인 출석 요청 관리

| 요청ID | 이름 | 팀 | 시즌 | 위도 | 경도 | 사유 | 사진URL | 선택한동료 | 요청일시 |
|--------|------|-----|------|------|------|------|---------|-----------|----------|
| REQ_xxx | 홍길동 | A | 상반기 | 37.xxx | 126.xxx | GPS 오류 | https://... | 김철수 | 2026-01-15 19:35 |

### 위치설정
출석 인정 위치 정보

| 항목 | 값 |
|------|-----|
| 위도 | 37.xxxx |
| 경도 | 126.xxxx |
| 장소명 | 서울 풋살장 |

### 설정
관리자 설정 정보

| 항목 | 값 |
|------|-----|
| 관리자비밀번호 | (해시값) |
| 출석시간 | 19:30 |
| 출석요일 | 6 (토요일) |
| 출석거리(m) | 50 |

## ⚙️ 설정 변경

### 출석 거리 제한 변경

`google-apps-script/Code.gs` 파일:

```javascript
const REQUIRED_RADIUS = 50; // 50미터 → 원하는 거리로 변경
```

### 출석 가능 요일 변경

`google-apps-script/Code.gs` 파일의 `processAttendance` 함수:

```javascript
// 토요일 확인
const now = new Date();
if (now.getDay() !== 6) {  // 6 = 토요일, 0 = 일요일, 1 = 월요일...
  return createResponse(false, '출석은 토요일만 가능합니다.');
}
```

### 팀 추가/변경

1. `index.html`, `admin.html` 파일에서 팀 선택 옵션 수정
2. `google-apps-script/Code.gs`에서 팀 검증 배열 수정:
   ```javascript
   if (!['A', 'B', 'C', 'D'].includes(team)) {  // D팀 추가
   ```

## 🔒 보안 및 제한사항

### 중복 출석 방지

- **기기 ID 기반**: 요청 헤더 해시값으로 기기 식별
- **로컬스토리지**: 브라우저에 출석 기록 저장
- **이름 중복 체크**: 당일 동일 이름 출석 방지
- **한계**: 다른 기기/브라우저에서는 우회 가능

### Google Drive 사진 저장

- **보안**: 관리자 계정의 Drive에만 저장 ("다음 계정으로 실행: 나" 설정 필수)
- **공개 권한**: 링크가 있는 모든 사용자가 볼 수 있음 (승인 과정에서 필요)
- **폴더 구조**: `출석요청사진/YYYY-MM-DD/파일명.jpg`
- **CORS 해결**: 썸네일 URL 사용 (`lh3.googleusercontent.com`)

### 개선 방안

더 강력한 보안이 필요하다면:
1. ✅ 로컬스토리지 체크 (구현됨)
2. ✅ 사진 인증 시스템 (구현됨)
3. 사용자 인증 시스템 추가 (Google 로그인 등)
4. 관리자가 수동으로 중복 제거

## 📱 모바일 최적화

- 반응형 디자인 적용
- 모바일에서 최적화된 UI/UX
- 터치 친화적인 버튼 크기
- GPS 정확도 높음 (enableHighAccuracy: true)

## 🆘 문제 해결

### 위치 정보를 가져올 수 없어요

- 브라우저 설정에서 위치 정보 권한 허용 확인
- HTTPS 연결 확인 (GitHub Pages는 자동 HTTPS)
- GPS가 켜져 있는지 확인

### 출석이 안돼요

- 위치가 50m 이내인지 확인
- 설정된 출석 요일인지 확인 (기본: 토요일)
- 이미 오늘 출석했는지 확인
- 관리자가 위치를 설정했는지 확인
- **해결 방법**: 출석 요청 기능 사용 (사진 촬영 후 관리자 승인)

### 사진 업로드가 안돼요 🆕

- **Drive 권한 오류 시**:
  1. Apps Script 배포 설정 확인
  2. "다음 계정으로 실행"이 **"나"**로 설정되었는지 확인
  3. Google Drive 권한 승인 완료 확인

- **사진이 보이지 않아요**:
  1. 관리자 페이지에서 "사진 보기" 버튼 클릭
  2. 사진 URL이 `lh3.googleusercontent.com` 형식인지 확인
  3. Google Drive의 "출석요청사진" 폴더에 실제 파일이 있는지 확인

### Google Apps Script URL을 못 찾겠어요

1. Google Sheets > 확장 프로그램 > Apps Script
2. 배포 > 배포 관리
3. 현재 배포 URL 복사

### 변경사항이 반영 안돼요

1. **프론트엔드 수정 시**: 브라우저 캐시 삭제 (Ctrl+Shift+R)
2. **Apps Script 수정 시**: 새 배포 생성 또는 기존 배포 수정 후 새 버전 배포

## 💡 추가 개선 아이디어

- [x] 출석 시 사진 촬영 기능 ✅
- [x] 관리자 비밀번호 설정 ✅
- [x] 시즌별 관리 (상반기/하반기) ✅
- [x] 출석 요청 승인 시스템 ✅
- [x] Google Drive 사진 저장 ✅
- [ ] 이메일/문자 알림
- [ ] 출석 리마인더
- [ ] 엑셀 내보내기 기능
- [ ] 다크 모드 지원
- [ ] PWA (앱처럼 설치 가능)

## 📄 라이선스

MIT License - 자유롭게 사용하세요!

## 🤝 기여

이슈나 개선 사항이 있다면 PR 환영합니다!

---

**만든이**: Claude
**버전**: 2.0.0
**마지막 업데이트**: 2026-01-15

### 주요 업데이트 (v2.0.0)
- 📸 사진 인증 기능 추가 (Google Drive 연동)
- 🎯 출석 요청 승인 시스템
- 📅 시즌별 관리 (상반기/하반기)
- ⏰ 지각 체크 기능
- 🔐 관리자 비밀번호 설정
- 📊 연도별 출석 기록 분리
